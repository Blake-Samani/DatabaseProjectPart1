<html>
    <head>
    <title>Administrator Page</title>
    </head>
            
    <body>
    
    
    <p> Welcome to the Administrator Page</p>

  

    <FORM name="Search" method="POST" action="searchuser.php"> 
        Search User ID: <INPUT type="text" name="clientid" required> 
        <INPUT type="submit" name="submit" value="Search"> 
    </FORM>
    <FORM name="Delete" method="POST" >
        Delete User: <INPUT type ="text" name="clientid" required>
        <INPUT type="submit" name="delete" value="Delete"> 
    </FORM>
   
    <form method="post"> 
        <input type="submit" name="button1"
                class="button" value="List All" /> 
    </form> 
    <FORM name="Add User" method="POST"> 
        Add User: <INPUT type="text" name="clientid" placeholder="user id" required>
            <INPUT type="password" name="passw" placeholder="password" required> 
                <INPUT type="text" name="fname" placeholder="first name" required> 
                    <INPUT type="text" name="lname" placeholder="last name" required> 
                        <INPUT type="text" name="accttype"placeholder="account type" required> 
                             
        <INPUT type="submit" name="usersubmit" value="Add"> 
    </FORM>

    <FORM name="Update User" method="POST"> 
        Update User: <INPUT type="text" name="clientid" placeholder="user id" required>
            <!-- <INPUT type="password" name="passw" placeholder="password" required>  -->
                <INPUT type="text" name="fname" placeholder="first name" required> 
                    <INPUT type="text" name="lname" placeholder="last name" required> 
                        <INPUT type="text" name="accttype"placeholder="account type" required> 
                             
        <INPUT type="submit" name="userupdate" value="Update"> 
    </FORM>

    <FORM name="Change My Password" method="POST"> 
        
        Update Password: <input type="text" name="password" placeholder = "New Password" required> 
        <INPUT type="submit" name="changepassword" value="Change Password">
    </FORM>

    <FORM name="Reset a users password" method="GET"> 
        Reset Password: <INPUT type="text" name="clientid" placeholder="user id" required>  
        <INPUT type="submit" name="resetpassword" value="Reset Password">
    </FORM>
    
    <form method="POST" action="logout_action_proj.php">
        <button type="submit" >Logout</button>
        </form>
    
    <?php
      
    if(isset($_POST['button1'])) { 
        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");
        $query = "select * from pageuser";
        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
            // For oci_parse errors, pass the connection handle
            $e = oci_error($connection);  
            die($e['message']);
         }
         $result = oci_execute ($cursor);
        if ($result == false){
        
        $e = oci_error($cursor);  
        die($e['message']);
        }
        echo "<table border=1>";
            echo "<tr> <th>userid</th> <th>passw</th> <th>fname</th>" . 
                  "<th>lname</th> <th>accounttype</th> </tr>";
            
            // fetch the result from the cursor one by one
            while ($nuvalues = oci_fetch_array ($cursor)){
              $userid = $nuvalues[0];
              $passw = $nuvalues[1];
              $fname = $nuvalues[2];
              $lname = $nuvalues[3];
              $accounttype = $nuvalues[4];
            
              echo "<tr><td>$userid</td> <td>$passw</td> <td>$fname</td>" .
                    "<td>$lname</td> <td>$accounttype</td> </tr>";
            }
            
            echo "</table>";
            
            
            // free up resources used by the cursor
            oci_free_statement($cursor);
            
            // close the connection with oracle
            oci_close ($connection);
    } 
    if(isset($_POST['delete'])) { 
        $clientid = $_POST["clientid"];
        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");

        if ($connection == false){
   
        $e = oci_error(); 
        die($e['message']);
        }

        $query = "delete " .
        "from pageuser " .
        "where userid='$clientid' ";

        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
   
         $e = oci_error($connection);  
        die($e['message']);
        }

        $result = oci_execute ($cursor);
        if ($result == false){
   
         $e = oci_error($cursor);  
        die($e['message']);
        }

        oci_free_statement($cursor);
        oci_close ($connection);
    } 
    if(isset($_POST['usersubmit'])) { 
        $clientid = $_POST["clientid"];
        $password = $_POST["passw"];
        $firstname = $_POST["fname"];
        $lastname = $_POST["lname"];
        $accounttype = $_POST["accttype"];

        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");
        if ($connection == false){
   
        $e = oci_error(); 
        die($e['message']);
        }
        $query = "INSERT " .
        "INTO pageuser (userid, passw, fname, lname, accttype) " .
        "VALUES ('$clientid', '$password', '$firstname', '$lastname', '$accounttype')";

        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
        $e = oci_error($connection);  
        die($e['message']);
        }
        $result = oci_execute ($cursor);
        if ($result == false){
   
        $e = oci_error($cursor);  
        die($e['message']);
        }
        oci_free_statement($cursor);
        oci_close ($connection);
    }

    if(isset($_POST['userupdate'])) { 
        $clientid = $_POST["clientid"];
        $password = $_POST["passw"];
        $firstname = $_POST["fname"];
        $lastname = $_POST["lname"];
        $accounttype = $_POST["accttype"];

        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");
        if ($connection == false){

        $e = oci_error(); 
        die($e['message']);
        }

        $query = "UPDATE pageuser " .
        "set userid = '$clientid', passw = '$password', fname = '$firstname', lname = '$lastname', accttype = '$accounttype' ".
        "WHERE userid = '$clientid'";

        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
   
        $e = oci_error($connection);  
        die($e['message']);
        }
        $result = oci_execute ($cursor);
        if ($result == false){
        $e = oci_error($cursor);  
        die($e['message']);
        }

        oci_free_statement($cursor);
        oci_close ($connection);
    }
    if(isset($_POST['changepassword'])) {
        $sessionid = $_GET["sessionid"];
        $password = $_GET["password"];

        echo "$sessionid";

        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");
        if ($connection == false){
        // For oci_connect errors, no handle needed
        $e = oci_error(); 
        die($e['message']);
        }

    $query = "UPDATE paguser " .
            "SET " .
            "passw = '$password' " .
            "WHERE userid IN (SELECT * FROM clientsesh WHERE session = '$sessionid') ";
                    
            

        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
            $e = oci_error($connection);  
            die($e['message']);
            }

            $result = oci_execute ($cursor);
            if ($result == false){
        // For oci_execute errors pass the cursor handle
            $e = oci_error($cursor);  
            die($e['message']);
            }
        
            oci_free_statement($cursor);
            oci_close ($connection);
     }
     if(isset($_POST['resetpassword'])) {
        $clientid = $_POST["clientid"];


        $connection = oci_connect ("gq008", "mjbrwe", "gqiannew2:1521/pdborcl");
        if ($connection == false){
        // For oci_connect errors, no handle needed
        $e = oci_error(); 
        die($e['message']);
        }

        // this is the SQL command to be executed
        $query = "UPDATE pageuser " .
                "set passw = 'default'" .
                "WHERE userid = '$clientid'";
                
        // parse the SQL command
        $cursor = oci_parse ($connection, $query);
        if ($cursor == false){
        // For oci_parse errors, pass the connection handle
        $e = oci_error($connection);  
        die($e['message']);
        }

        // execute the command
        $result = oci_execute ($cursor);
        if ($result == false){
        // For oci_execute errors pass the cursor handle
        $e = oci_error($cursor);  
        die($e['message']);
        }

        oci_free_statement($cursor);

        // close the connection with oracle
        oci_close ($connection);

            }



   
   
?> 
  
    </body>
    </html>